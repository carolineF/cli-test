#!/usr/bin/env node

const program = require('commander')
const pkg = require('../package')
const chalk = require('chalk')
const download = require('download-git-repo');
const ora = require('ora');
const fs = require('fs');
const path = require('path');
const spinner = ora('Loading undead unicorns');
const initial = require('../packages/commands/initial');
const gmodule = require('../packages/commands/module');
const build = require('../packages/commands/build');

let config = {};
if(fs.existsSync(path.resolve('cli.config.js'))) {
  config = require(path.resolve('cli.config.js'));
}

/**
 * version
 */
program
  .version(chalk.green(`${pkg.version}`))
  .command('init')
  .description('initialize your cli config')
  .action(initial)

program
  .command('new [module]')
  .description('generator a new module')
  .action(function(module) {
    gmodule(config, module);
  })

program
  .command('build [module]')
  .description('git build specify module and assets upload to CDN!')
  .action(function(module) {
    build(config, module)
  })

/**
*
*/
program
  .command('start')
  .description('开始打开项目')
  .action(() => {
    console.log('========')
  })

/**
* init 项目
*/
/**
program
  .command('init <template> <app-name>')
  .description('初始化项目')
  .option('-c, --clone', '使用git 克隆项目')
  .action((template, appName, cmd) => {
    spinner.start('开始下载');
    download('direct:https://github.com/study-demo/cli-demo.git', appName, { clone: true }, err => {
      if (err) {
        spinner.fail(chalk.green('下载失败 \n' + err));
        process.exit();
      }
      spinner.succeed(chalk.green(`下载成功`));
    });
  })
*/
program.parse(process.argv);
